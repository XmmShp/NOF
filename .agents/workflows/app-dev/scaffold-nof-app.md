---
description: How to scaffold a new NOF web application from scratch
---

# Scaffold a New NOF Web Application

Creates a new ASP.NET Core application powered by the NOF framework with clean architecture project structure.

## Project Structure

```
MyApp/
  MyApp/                    — Host project (Program.cs, DbContext, appsettings.json)
  MyApp.Domain/             — Domain layer (entities, aggregate roots, value objects, events, repositories)
  MyApp.Application/        — Application layer (handlers, event handlers, state machines, cache keys)
  MyApp.Contract/           — Contract layer (requests, commands, notifications, DTOs)
```

## Steps

1. Create the solution and projects:
   ```bash
   dotnet new sln -n MyApp
   dotnet new web -n MyApp -o MyApp
   dotnet new classlib -n MyApp.Domain -o MyApp.Domain
   dotnet new classlib -n MyApp.Application -o MyApp.Application
   dotnet new classlib -n MyApp.Contract -o MyApp.Contract
   dotnet sln add MyApp MyApp.Domain MyApp.Application MyApp.Contract
   ```

2. Add NOF NuGet packages to the host project:
   ```bash
   cd MyApp
   dotnet add package NOF.Hosting.AspNetCore
   dotnet add package NOF.Infrastructure.Core
   dotnet add package NOF.Infrastructure.EntityFrameworkCore.PostgreSQL
   dotnet add package NOF.Infrastructure.MassTransit.RabbitMQ
   dotnet add package NOF.Infrastructure.StackExchangeRedis
   dotnet add package NOF.Infrastructure.Extension.Authorization.Jwt
   ```

3. Add NOF layer packages:
   ```bash
   # Domain project
   cd ../MyApp.Domain
   dotnet add package NOF.Domain

   # Contract project
   cd ../MyApp.Contract
   dotnet add package NOF.Contract

   # Application project
   cd ../MyApp.Application
   dotnet add package NOF.Application
   dotnet add reference ../MyApp.Domain/MyApp.Domain.csproj
   dotnet add reference ../MyApp.Contract/MyApp.Contract.csproj
   ```

4. Add project references to the host project:
   ```bash
   cd ../MyApp
   dotnet add reference ../MyApp.Application/MyApp.Application.csproj
   dotnet add reference ../MyApp.Contract/MyApp.Contract.csproj
   ```

5. Create `Program.cs` in the host project:
   ```csharp
   using NOF.Hosting.AspNetCore;
   using NOF.Infrastructure.EntityFrameworkCore;
   using NOF.Infrastructure.EntityFrameworkCore.PostgreSQL;
   using NOF.Infrastructure.MassTransit;
   using NOF.Infrastructure.MassTransit.RabbitMQ;
   using NOF.Infrastructure.StackExchangeRedis;

   var builder = NOFWebApplicationBuilder.Create(args, useDefaultConfigs: true);

   // Register auto-generated DI services and handlers
   // builder.Services.AddMyAppAutoInjectServices();  // Generated by [AutoInject]
   // builder.Services.AddAllHandlers();               // Generated by source generator

   builder.AddRedisCache();

   builder.AddMassTransit()
       .UseRabbitMQ();

   builder.AddEFCore<AppDbContext>()
       .AutoMigrate()
       .UsePostgreSQL();

   var app = await builder.BuildAsync();

   app.MapAllHttpEndpoints();

   await app.RunAsync();
   ```

6. Create `AppDbContext.cs` in the host project:
   ```csharp
   using Microsoft.EntityFrameworkCore;
   using NOF.Infrastructure.EntityFrameworkCore;

   public class AppDbContext : NOFDbContext
   {
       public AppDbContext(DbContextOptions<AppDbContext> options) : base(options) { }

       // Add DbSet<T> properties for your entities here

       protected override void OnModelCreating(ModelBuilder modelBuilder)
       {
           base.OnModelCreating(modelBuilder);
           // Configure entity mappings here
       }
   }
   ```

7. Configure `appsettings.json`:
   ```json
   {
     "ConnectionStrings": {
       "DefaultConnection": "Host=localhost;Database=myapp;Username=postgres;Password=postgres",
       "redis": "localhost:6379"
     },
     "NOF": {
       "DbContextFactory": {
         "AutoMigrate": true
       }
     },
     "RabbitMQ": {
       "Host": "localhost",
       "Username": "guest",
       "Password": "guest"
     }
   }
   ```

8. Set up the domain project folder structure:
   ```
   MyApp.Domain/
     AggregateRoots/
     Entities/
     Events/
     Repositories/
     ValueObjects/
   ```

9. Set up the application project folder structure:
   ```
   MyApp.Application/
     RequestHandlers/
     EventHandlers/
     Handlers/
     CacheKeys/
     Repositories/
     StateMachines/
   ```

10. Set up the contract project folder structure:
    ```
    MyApp.Contract/
      Requests/
    ```

## Notes

- `NOFWebApplicationBuilder.Create(args, useDefaultConfigs: true)` sets up OpenTelemetry, JSON serialization, OpenAPI (Scalar), and other defaults.
- `builder.Services.AddAllHandlers()` is generated by the source generator — it auto-discovers all `IRequestHandler`, `ICommandHandler`, and `INotificationHandler` implementations.
- `builder.Services.AddMyAppAutoInjectServices()` is generated from classes marked with `[AutoInject]`.
- `app.MapAllHttpEndpoints()` maps all requests marked with `[ExposeToHttpEndpoint]` to HTTP routes.
- Always call `base.OnModelCreating(modelBuilder)` in your `NOFDbContext` subclass — it configures outbox/inbox tables.
